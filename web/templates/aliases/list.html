{% extends "baseSimple.html" %}
{% block title %}Avrae - Alias List{% endblock %}
{% block css %}
<link href="{{url_for('static', filename='aliases/list.css')}}" rel="stylesheet">
{% endblock %}
{% block main %}
    <div class="col-xs-12">
      <h1>Aliases</h1>
      <p class="important">
        A list of all of your aliases, snippets, and cvars.
      </p>
      <h3>Aliases</h3>
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="col-xs-2">Alias</th>
            <th class="col-xs-8">Commands</th>
            <th class="col-xs-2"></th>
          </tr>
        </thead>
        <tbody>
          {% for alias, commands in aliases.items() %}
            <tr>
              <td>{{alias}}</td>
              <td><pre>{{commands}}</pre></td>
              <td>
                <button class="btn btn-default" type="submit">Edit</button>
                <button class="btn btn-danger" type="button" data-toggle="modal" data-target="#deleteModal" data-name="{{alias}}" data-type="alias">Delete</button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <h3>Snippets</h3>
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="col-xs-2">Snippet</th>
            <th class="col-xs-8">Arguments</th>
            <th class="col-xs-2"></th>
          </tr>
        </thead>
        <tbody>
          {% for snippet, args in snippets.items() %}
            <tr>
              <td>{{snippet}}</td>
              <td><pre>{{args}}</pre></td>
              <td>
                <button class="btn btn-default" type="submit">Edit</button>
                <button class="btn btn-danger" type="button" data-toggle="modal" data-target="#deleteModal" data-name="{{snippet}}" data-type="snippet">Delete</button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <h3>Cvars</h3>
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="col-xs-2">Character</th>
            <th class="col-xs-10">Variables</th>
          </tr>
        </thead>
        <tbody>
          {% for cid, vars in cvars.items() %}
            <tr>
              <td>{{chars.get(cid, {}).get('stats', {}).get('name', 'No name')}}</td>
              <td>
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th class="col-xs-2">Name</th>
                      <th class="col-xs-8">Value</th>
                      <th class="col-xs-2"></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for name, value in vars.items() %}
                      <tr>
                        <td>{{name}}</td>
                        <td><pre>{{value}}</pre></td>
                        <td>
                          <button class="btn btn-default" type="submit">Edit</button>
                          <button class="btn btn-danger" type="button" data-toggle="modal" data-target="#deleteModal" data-name="{{name}}" data-type="cvar-{{cid}}">Delete</button>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content modal-sm">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="deleteModalLabel">Deleting ...</h4>
          </div>
          <div class="modal-body">
            Are you sure you want to delete ...?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal" id="deleteModalConfirm">Delete</button>
          </div>
          <div class="modal-data-type hidden">...</div>
          <div class="modal-data hidden">...</div>
        </div>
      </div>
    </div>
{% endblock %}
{% block js %}
<script>
$('#deleteModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var target = button.data('name') // Extract info from data-* attributes
  var type = button.data('type') // Extract info from data-* attributes
  var modal = $(this)
  modal.find('.modal-title').text('Deleting ' + target)
  modal.find('.modal-data').text(target)
  modal.find('.modal-data-type').text(type)
  modal.find('.modal-body').text('Are you sure you want to delete ' + target + '?')
})
  
$('#deleteModalConfirm').click(function() {
  var modal = $('#deleteModal')
  var type = modal.find('.modal-data-type').text()
  var target = modal.find('.modal-data').text()
  $.post("delete", {name: target, type: type})
    .done(function() {
      alert( "deleted!" );
      window.location.reload(false); // fix this later
    })
    .fail(function() {
      alert( "error" );
    })
})
</script>
{% endblock %}